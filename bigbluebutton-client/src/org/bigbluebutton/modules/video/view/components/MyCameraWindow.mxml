<?xml version="1.0" encoding="utf-8"?>

<!--
  BigBlueButton - http://www.bigbluebutton.org
  
  Copyright (c) 2008-2009 by respective authors (see below). All rights reserved.
  
  BigBlueButton is free software; you can redistribute it and/or modify it under the 
  terms of the GNU Lesser General Public License as published by the Free Software 
  Foundation; either version 3 of the License, or (at your option) any later 
  version. 
  
  BigBlueButton is distributed in the hope that it will be useful, but WITHOUT ANY 
  WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A 
  PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.
  
  You should have received a copy of the GNU Lesser General Public License along 
  with BigBlueButton; if not, If not, see <http://www.gnu.org/licenses/>.
 
  $Id: $
--> 

<cam:MDIWindow xmlns:mx="http://www.adobe.com/2006/mxml"
					  xmlns:cam="flexlib.mdi.containers.*"
					  xmlns:util="org.bigbluebutton.modules.video.view.components.*"
					  xmlns:monitor="org.bigbluebutton.modules.video.view.monitor.*"
					  resizable="false" width="326" height="312" 
					  implements="org.bigbluebutton.common.IBbbModuleWindow"
					  creationComplete="startBroadcasting()">
	<mx:Script>
		<![CDATA[
			import flexlib.mdi.events.MDIWindowEvent;
			import org.bigbluebutton.modules.video.view.components.Images;
			import org.bigbluebutton.modules.video.model.vo.BroadcastMedia;
					
			import flash.events.*;
			import mx.managers.PopUpManager;
			import mx.controls.*;
			import mx.binding.utils.BindingUtils;		
			import mx.events.CloseEvent;            
            import mx.containers.TitleWindow;
            import flash.geom.Point;			

			public static const BROADCAST_STREAM:String = "BROADCAST_STREAM";
			public static const STOP_BROADCAST_STREAM:String = "STOP_BROADCAST_STREAM";
			public static const START_DEVICES:String = "START_DEVICES";
			public static const STOP_DEVICES:String = "STOP_DEVICES";
			public static const WINDOW_CLOSE_EVENT:String = "WINDOW_CLOSE_EVENT";
			public static const CLOSE_CLICKED:String = "Close Clicked";
			public static const OPEN_SETTINGS:String = "Open Settings";
		
			private var _xPosition:int;
			private var _yPosition:int;
					
			private var images:Images = new Images();
			
			[Bindable] public var media:BroadcastMedia;
		    [Bindable] private var serverLogo:Class = images.red5_img;
		    
		    //The following code block is to deal with a bug in FLexLib with MDI windows not responding well to being maximized
			private var savedWindowWidth:Number;
			private var savedWindowHeight:Number;
			private var savedX:Number;
			private var savedY:Number;
			private var isMaximized:Boolean = false;
			override public function maximize():void{
				if (!isMaximized){
					savedWindowHeight = this.height;
					savedWindowWidth = this.width;
					savedX = this.x;
					savedY = this.y;
                	dispatchEvent(new MDIWindowEvent(MDIWindowEvent.MAXIMIZE, this));
                	isMaximized = true;
				} else{
					this.width = savedWindowWidth;
					this.height = savedWindowHeight;
					this.x = savedX;
					this.y = savedY;
					isMaximized = false;
					//dispatchEvent(new MDIWindowEvent(MDIWindowEvent.RESTORE, this));
				}	
			}
			
            public override function close(event:MouseEvent = null):void 
            { 	
            	LogUtil.debug('closing my camera window');
                 dispatchEvent(new Event(STOP_BROADCAST_STREAM));
                 dispatchEvent(new Event(WINDOW_CLOSE_EVENT));
                 //super.close(event); 
            } 
            
			public function startBroadcasting():void
			{
				dispatchEvent(new Event(BROADCAST_STREAM));
			}       
			
			public function get xPosition():int {
				return _xPosition;
			}
			
			public function get yPosition():int {
				return _yPosition;
			}
			
			public function set xPosition(x:int):void {
				_xPosition = x;
			}
			
			public function set yPosition(y:int):void {
				_yPosition = y;
			}

		]]>
	</mx:Script>
		<mx:Canvas id="monDisplay" width="320" height="240"
				backgroundColor="0xFFFFFF" borderStyle="solid" borderColor="0xD0D0D0"
				paddingBottom="0" cornerRadius="2">
			<util:VideoContainer id="localVideo" height="100%" width="100%"/>
		</mx:Canvas>
</cam:MDIWindow>
