#!/bin/bash

# Updates
#
# Date       Update
# ========== ==========================================================
# 2009-06-17 Output proper LOGNAME and IP address when setting up samba
#

if [ "$#" -eq 0 ]; then
	echo "
bbb-setupdev: Setup a BigBlueButton Development environment

Usage:
	-s : Setup Samba (you'll be asked for your password to run sudo)
	-d : Setup development environment
"
fi

while getopts "sd" flag
do
  case "$flag" in
    s) echo "Setting up Samba"
        SAMBA=1
        ;;

    d) echo "Setting up BigBlueButton Devopment for $LOGNAME"
        DEV=1
        ;;

     *) break;;
  esac 
done



#
# Setup Samba
#

if [ $SAMBA ]; then

        #
        # Instal Samba
        #
        if ! dpkg-query -s samba > /dev/null 2>&1; then
                sudo apt-get install --force-yes samba ant
        fi

        #
        # Add a share to samba
        #
        if ! grep -q $LOGNAME /etc/samba/smb.conf; then

		IP="$(ifconfig eth0 | sed -n '/inet /{s/.*addr://;s/ .*//;p}')"
                echo ";
; BigBlueButton: Share the development directory
[$LOGNAME]
   comment = BigBlueButton Development share
   path = /home/$LOGNAME
   browseable = yes
   read only = no
   create mask = 0755
   directory mask = 0775
   guest ok = yes
   force user = $LOGNAME
" | sudo tee -a /etc/samba/smb.conf > /dev/null 2>&1

                sudo /etc/init.d/samba restart
                
        echo "
You can now access your development folder either through

	\\\\$(hostname)\\$LOGNAME

or

	\\\\$IP\\$LOGNAME
	
If you are running on Windows, you can map the above path to a drive letter.
"
        else
        	echo "Already detected a definition for $LOGNAME in /etc/samba/smb.conf"
        	echo "No changes were made to /etc/samba/smb.conf"
        fi
fi
#
# Setup dev

if [ $DEV ]; then

	echo "
#
# Checking out BigBlueButton Apps for red5
#
	"
	cd ~/dev
	if [ ! -d bigbluebutton-apps ]; then
		svn checkout http://bigbluebutton.googlecode.com/svn/trunk/bigbluebutton-apps bigbluebutton-apps
		cd bigbluebutton-apps

		#./build.sh
	fi

	echo "
#
# Checking out BigBlueButton Web application for tomcat
#
	"
	cd ~/dev
	if [ ! -d bigbluebutton-web ]; then
		svn checkout http://bigbluebutton.googlecode.com/svn/trunk/bigbluebutton-web bigbluebutton-web
		cd bigbluebutton-web
		grails set-version 0.1

		#./build.sh
	fi

	echo "
#
# Checking out BigBlueButton Flash client
#
	"
	cd ~/dev
	if [ ! -d bigbluebutton-client ]; then
		svn checkout http://bigbluebutton.googlecode.com/svn/trunk/bigbluebutton-client bigbluebutton-client
		cd bigbluebutton-client

		#./build.sh
	fi
	
	echo "
To build any of bigbluebutton-dev, bigbluebutton-client, or bigbluebutton-web, just change to the associated directory 
and issue the command

	./build.sh
"
cd ~/dev

fi

