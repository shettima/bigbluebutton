<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" creationComplete="onCreationComplete()" xmlns:local="*">
	
	<mx:Script>
		<![CDATA[
			import mx.controls.Alert;
			import mx.core.UIComponent;
			private var proxy:ServerProxy;
			private var videoHolder:UIComponent = new UIComponent();
			private var videoPlayer:Video;
			private var ns:NetStream;
			
			private var capturing:Boolean = false;
			
			private function onCreationComplete():void{
				proxy = new ServerProxy();
				videoPlayer = new Video(800, 600);
				videoHolder.setActualSize(800, 600);
				videoHolder.addChild(videoPlayer);
				canvas.addChild(videoHolder);
				videoHolder.x = 0;
				videoHolder.y = 0;
			}
			
			private function startApplet():void{
				if (captureRoomNumber.text == ""){
					Alert.show("Please enter the room number");
					return;
				}
				ExternalInterface.call("startApplet", captureRoomNumber.text);
				dimensionsBox.visible = true;
				
				capturing = true;
				btnStopApplet.enabled = true;
				btnStartApplet.enabled = false;
				
			}
			
			private function startViewing():void{
				if (viewingRoomNumber.text == ""){
					Alert.show("Please enter the room number");
					return;
				}
				ns = new NetStream(proxy.getConnection());
				ns.client = this;
				ns.bufferTime = 0;
				ns.receiveVideo(true);
				ns.receiveAudio(false);
				videoPlayer.attachNetStream(ns);
				ns.play(viewingRoomNumber.text);
				
				btnStopViewing.enabled = true;
				btnStartViewing.enabled = false;
			}
			
			private function stopApplet():void{
				btnStopApplet.enabled = false;
				btnStartApplet.enabled = true;
				ExternalInterface.call("stopApplet");
			}
			
			private function stopViewing():void{
				btnStopViewing.enabled = false;
				btnStartViewing.enabled = true;
				ns.close();
			}
		]]>
	</mx:Script>
	
	<mx:Canvas id="canvas" x="0" y="0" width="800" height="600" /> 
	<mx:Button id="btnStartViewing" x="410" y="608" label="StartViewing" click="startViewing()"/>
	<mx:Label x="128" y="610" text="Room Number :"/>
	<mx:TextArea x="230" y="609" width="65" height="19" id="captureRoomNumber"/>
	<mx:Label x="517" y="610" text="Room Number :"/>
	<mx:TextArea x="619" y="609" width="65" height="19" id="viewingRoomNumber"/>
	<mx:Button id="btnStartApplet" x="10" y="608" label="Start Capturing" click="startApplet()"/>
	<local:DimensionsBox id="dimensionsBox" x="900" y="100" visible="false" />
	<mx:Button x="10" id="btnStopApplet" y="636" label="Stop Capturing" click="stopApplet()" enabled="false"/>
	<mx:Button x="410" id="btnStopViewing" y="636" label="Stop Viewing" click="stopViewing()" enabled="false"/>
</mx:Application>
